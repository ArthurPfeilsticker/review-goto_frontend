<app-header></app-header>

<main class="page-container">
  
  <div class="page-header">
    <div>
      <h1>Gestão de Usuários</h1>
      <p class="subtitle">Administre o acesso e permissões do sistema</p>
    </div>
    <button class="btn-primary" (click)="openCreate()">
      <i class="bi bi-plus-lg"></i> Novo Usuário
    </button>
  </div>

  <div class="content-card">
    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th class="col-id">Nome</th>
            <th>E-mail</th>
            <th>Função</th>
            <th class="col-actions">Ações</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="users.length === 0">
            <td colspan="5" class="empty-state">Nenhum usuário encontrado.</td>
          </tr>

          <tr *ngFor="let user of users">
            <td class="fw-bold">{{ user.name }}</td>
            <td class="text-muted">{{ user.email }}</td>
            <td>
              <span class="badge" [ngClass]="user.role">
                {{ user.role | titlecase }}
              </span>
            </td>
            <td class="col-actions">
              <button class="btn-icon edit" (click)="openEdit(user)" title="Editar">
                <i class="bi bi-pencil-fill"></i>
              </button>
              <button class="btn-icon delete" (click)="deleteUser(user.id)" title="Excluir">
                <i class="bi bi-trash-fill"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal-overlay" *ngIf="showForm">
    <div class="modal-card fade-in">
      <div class="modal-header">
        <h2>{{ isEditMode ? 'Editar Usuário' : 'Criar Usuário' }}</h2>
        <button class="btn-close" (click)="showForm = false"><i class="bi bi-x-lg"></i></button>
      </div>
      
      <form (ngSubmit)="onSubmit()">
        <div class="form-body">
          <div class="form-group">
            <label>Nome Completo</label>
            <input [(ngModel)]="currentUser.name" name="name" class="form-control" required placeholder="Ex: João Silva">
          </div>
          
          <div class="form-group">
            <label>E-mail</label>
            <input [(ngModel)]="currentUser.email" name="email" class="form-control" required type="email" placeholder="nome@empresa.com">
          </div>

          <div class="form-group">
            <label>Função</label>
            <div class="select-wrapper">
              <select [(ngModel)]="currentUser.role" name="role" class="form-control">
                <option value="user">User (Padrão)</option>
                <option value="supervisor">Supervisor</option>
                <option value="admin">Administrador</option>
              </select>
              <i class="bi bi-chevron-down select-icon"></i>
            </div>
          </div>

          <div class="form-group">
            <label>Senha</label>
            <input [(ngModel)]="currentUser.password" name="password" type="password" class="form-control" 
                   [placeholder]="isEditMode ? '(Opcional) Digite para alterar' : 'Senha de acesso'">
            <small class="hint" *ngIf="isEditMode">Deixe em branco para manter a senha atual.</small>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-secondary" (click)="showForm = false">Cancelar</button>
          <button type="submit" class="btn-primary">Salvar Dados</button>
        </div>
      </form>
    </div>
  </div>

</main>